<!DOCTYPE html>
<html lang="en">
<!--引入thymeleaf-->

<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <title>其他</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../static/layui/css/layui.css">

    <link rel="stylesheet" href="../static/layui/css/font_view/iconfont.css">
    <link rel="stylesheet" href="../static/layui/css/ttb_icon/iconfont.css">

    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="../static/layui/css/image.css">

    <script type="text/javascript" src="../static/layui/jquery-2.2.3.min.js"></script>
</head>
<body>



<!--头部工具栏-->
<script type="text/html" id="toolbarDemo">
    <div class="layui-container">
        <div class="layui-row">

            <div class="layui-col-md8">
                <button class="layui-btn layui-btn-primary  layui-btn-sm"  lay-event="choose_file">
                    <i class="layui-icon"> &#xe621;</i>
                    <span>选择文件</span>
                </button>

                <button class="layui-btn layui-btn-primary  layui-btn-sm"  lay-event="upload">
                    <i class="layui-icon">&#xe62f;</i>
                    <span>上传</span>
                </button>
                <button class="layui-btn layui-btn-primary  layui-btn-sm"  lay-event="download">
                    <i class="layui-icon">&#xe601;</i>
                    <span>下载</span>
                </button>
                <button class="layui-btn layui-btn-primary  layui-btn-sm" lay-event="share">
                    <i class="layui-icon">&#xe641;</i>
                    <span>分享</span>
                </button>
                <button class="layui-btn layui-btn-primary  layui-btn-sm" lay-event="del">
                    <i class="layui-icon">&#xe640;</i>
                    <span>删除</span>
                </button>
            </div>



            <div class=" layui-col-md4">
                <div class="btn-group">
                    <button type="button" class="btn btn-default btn-xs dropdown-toggle"
                            data-toggle="dropdown">
                        <i class="layui-icon">&#xe601;</i>
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="#" lay-event="jiangxu">降序</a></li>
                        <li><a href="#" lay-event="shengxu">升序</a></li>
                        <li><a href="#" lay-event="other">其他</a></li>
                        <li class="divider"></li>
                        <li><a href="#">分离的链接</a></li>
                    </ul>
                </div>
            </div>


        </div>
    </div>
</script>

<!--表格-->
<table class="layui-hide" id="image_li" lay-filter="test"></table>


<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">下载</a>
</script>



<!--记住引入jq!!!!-->
<script src="../static/layui/layui.js"></script>
<script src="../static/layui/css/ttb_icon/iconfont.js"></script>



<script  th:inline="none">


    layui.use(['table', 'element','util'], function(){
        var table = layui.table //表格
            ,element = layui.element //元素操作
            ,  util = layui.util;//工具集


        //执行一个 table 实例
        table.render({
            elem: '#image_li'
            ,height: 540
            ,url: 'image_list' //数据接口
            ,title: '图片列表'
            ,page: true //开启分页
            ,defaultToolbar: []//toolbar默认的工具
            ,toolbar: '#toolbarDemo' //开启工具栏
            ,cols: [[ //表头
                {type:'checkbox', fixed: 'left'}
                ,{field:'fileName', width:320, title: '文件名', sort: true ,templet: function(d){
                    return '   <span>\n' +
                        '                     <svg class="icon" aria-hidden="true">\n' +
                        '                       <use xlink:href="#icon-tupian"></use>\n' +
                        '                   </svg>\n' +
                        '                   </span>   ' +
                        '  <span>'+ d.fileName +'</span>'
                }}
                , {field: 'updateDate', width: 320, title: '修改日期', sort: true,
                    templet: '<div>{{ layui.util.toDateString(d.updateDate) }}</div>'
                }
                ,{field:'fileSize', width:320, title: '大小'}
                ,{fixed: 'right', width: 200, align:'center', toolbar: '#barDemo'}
            ]]
        });


        //头工具栏事件
        table.on('toolbar(test)', function(obj){
            var checkStatus = table.checkStatus(obj.config.id)
                ,data = checkStatus.data; //获取选中的数据;
            switch(obj.event){
                case 'reduction':
                    if(data.length==0)
                    {
                        layer.msg('请选择要还原的行');
                    }
                    else if(data.length>=1)
                    {
                        var temID = "";
                        //批量获取选中行的评估模板ID
                        for (i = 0; i < data.length; i++) {
                            if (temID == "") {
                                temID = data[i].fileId;
                            }
                            else {
                                temID = data[i].fileId+ "," + temID;
                            }
                        }

                        var id= checkStatus.data[0].fileId;
                        layer.confirm('确定还原选中的文件吗？', function(index)
                        {
                            $.ajax(
                                {
                                    url: "recycle_reduction",
                                    type: "post",
                                    dataType: "json",
                                    async: false,
                                    data: {
                                        fileid:temID
                                    },
                                    success: function (map)
                                    {
                                        var json = eval(map); //数组
                                        //能够正常返回数据才为成功
                                        //layer.alert('删除成功');
                                        var state=map.data;
                                        if (state)
                                        {
                                            layer.msg('还原成功');
                                            table.reload('recycle_bin', {});
                                        }
                                        else
                                        {
                                            layer.msg('还原失败');
                                        }
                                    },
                                    error: function () {
                                        layer.alert("失败");
                                    }
                                });
                        });
                    }
                    break;

                case 'shuaxin':
                    //layer.msg('刷新数据');
                    table.reload('recycle_bin', {});
                    break;

                case 'del':
                    if(data.length==0)
                    {
                        layer.msg('请选择要删除的行');
                    }
                    else if(data.length>=1)
                    {
                        var temID = "";
                        //批量获取选中行的评估模板ID
                        for (i = 0; i < data.length; i++) {
                            if (temID == "") {
                                temID = data[i].fileId;
                            }
                            else {
                                temID = data[i].fileId+ "," + temID;
                            }
                        }

                        var id= checkStatus.data[0].fileId;
                        layer.confirm('确定删除选中的行吗？', function(index)
                        {
                            $.ajax(
                                {
                                    url: "recycle_del",
                                    type: "post",
                                    dataType: "json",
                                    async: false,
                                    data: {
                                        fileid:temID
                                    },
                                    success: function (map)
                                    {
                                        var json = eval(map); //数组
                                        //能够正常返回数据才为成功
                                        //layer.alert('删除成功');
                                        var state=map.data;
                                        if (state)
                                        {
                                            layer.msg('删除成功');
                                            table.reload('recycle_bin', {});
                                        }
                                        else
                                        {
                                            layer.msg('删除失败');
                                        }
                                    },
                                    error: function () {
                                        layer.alert("错误");
                                    }
                                });
                        });
                    }
                    break;
                case'delAll':
                    layer.confirm('确定清空回收站吗？', function()
                    {
                        $.ajax(
                            {
                                url: "recycle_delAll",
                                type: "post",
                                dataType: "json",
                                async: false,
                                data: {
                                    //fileid:temID
                                },
                                success: function (map)
                                {
                                    var json = eval(map); //数组
                                    var state=map.data;
                                    if (state)
                                    {
                                        layer.msg('清除成功');
                                        table.reload('recycle_bin', {});
                                    }
                                    else
                                    {
                                        layer.msg('清除失败');
                                    }
                                },
                                error: function () {
                                    layer.alert("错误");
                                }
                            });
                    });
                    break;
                case 'jiangxu':
                    layer.msg('降序！！！');
                    // table.reload('image_li', {});
                    break;


                case 'shengxu':
                    layer.msg('升序！！！');
                    // table.reload('image_li', {});
                    break;


                case 'other':
                    layer.msg('其他！！！');
                    // table.reload('image_li', {});
                    break;


                case 'shezhi':
                    layer.msg('选择保存天数');
                    // table.reload('image_li', {});
                    break;
            };
        });



    });

</script>
</body>
</html>


